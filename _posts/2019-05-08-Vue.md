---
layout: post
title: 没事儿看看Vue源码，挺好的
subtitle: code of Vue 🎨
author: "malin"
header-style: text
tags:
  - vue
---

## 初始化

```js
vm._self = vm;
initLifecycle(vm);
initEvents(vm);
initRender(vm);
callHook(vm, 'beforeCreate');
initInjections(vm); // resolve injections before data/props
initState(vm);
initProvide(vm); // resolve provide after data/props
callHook(vm, 'created');

// send initial data to native
var data = vm.$options.data;
var params = typeof data === 'function'
  ? getData(data, vm)
  : data || {};
if (isPlainObject(params)) {
  updateComponentData(componentId, params);
}

registerComponentHook(componentId, 'lifecycle', 'attach', function () {
  callHook(vm, 'beforeMount');

  var updateComponent = function () {
    vm._update(vm._vnode, false);
  };
  new Watcher(vm, updateComponent, noop, null, true);

  vm._isMounted = true;
  callHook(vm, 'mounted');
});
```

### initProvide / initInjections
```js
export function initProvide (vm: Component) {
  const provide = vm.$options.provide
  if (provide) {
    vm._provided = typeof provide === 'function'
      ? provide.call(vm)     // 绑定this
      : provide
  }
}

export function initInjections (vm: Component) {
  const result = resolveInject(vm.$options.inject, vm)
  if (result) {
    toggleObserving(false)
    Object.keys(result).forEach(key => {
      /* istanbul ignore else */
      if (process.env.NODE_ENV !== 'production') {
        defineReactive(vm, key, result[key], () => {
          warn(
            `Avoid mutating an injected value directly since the changes will be ` +
            `overwritten whenever the provided component re-renders. ` +
            `injection being mutated: "${key}"`,
            vm
          )
        })
      } else {
        defineReactive(vm, key, result[key])
      }
    })
    toggleObserving(true)
  }
}
```