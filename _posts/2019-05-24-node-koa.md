---
layout: post
title: Node--Koa
author: "malin"
header-style: text
tags:
  - node
---

比较了几个流行的node框架，发现koa的设计思想是我比较欣赏的：

- 代码只有1000多行
- 插件很丰富

> 本文跟着[阮老师](http://www.ruanyifeng.com/blog/2017/08/koa.html)，一起搭建一个简单的koa环境

# 基本用法

```javascript
const Koa = require('koa');
const app = new Koa();

const main = ctx => {
  ctx.response.body = 'Hello World';
};

app.use(main);
app.listen(3000);
```

好，本篇文章结束。哈哈哈，开个玩笑。

## 处理请求

我使用node大部分情况都是用来处理请求的

```javascript
const Koa = require('koa');
const app = new Koa();
const main = ctx => {
  if (ctx.request.url.indexOf('test.html') !== -1) {
    ctx.response.type = 'html';
    ctx.response.body = '<a href="/">Index Page</a>';
  } else {
    ctx.response.body = 'Hello World';
  }
};

app.use(main);
app.listen(3000);
```

这样就可以很方便的对请求进行处理，并设计response。

# 好用的插件

## @koa/core

这个插件是用来处理跨域的，[文档](https://www.npmjs.com/package/@koa/cors)

```javascript
/**
 * CORS middleware
 *
 * @param {Object} [options] 
 *  - {String|Function(ctx)} origin `Access-Control-Allow-Origin`, default is request Origin header
 *  - {String|Array} allowMethods `Access-Control-Allow-Methods`, default is 'GET,HEAD,PUT,POST,DELETE,PATCH'
 *  - {String|Array} exposeHeaders `Access-Control-Expose-Headers`
 *  - {String|Array} allowHeaders `Access-Control-Allow-Headers`
 *  - {String|Number} maxAge `Access-Control-Max-Age` in seconds
 *  - {Boolean} credentials `Access-Control-Allow-Credentials`
 *  - {Boolean} keepHeadersOnError Add set headers to `err.header` if an error is thrown
 * @return {Function} cors middleware
 * @api public
 */

const Koa = require('koa');
const cors = require('@koa/cors');
const app = new Koa();
app.use(cors({credentials: true}));
```

## koa-static

这个插件用来发布静态资源，[koa-static](https://www.npmjs.com/package/koa-static)

```javascript
const path = require('path');
const serve = require('koa-static');

const main = serve(path.join(__dirname));
app.use(main);
```